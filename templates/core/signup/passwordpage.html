{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NexusCrypto | Set Your Password</title>
    <link rel="stylesheet" href="{% static 'css/login.css' %}" type="text/css" media="all" />
    <style>
        .password-toggle { cursor: pointer; color: #9ca3af; font-size: 14px; margin-top: 6px; }
        .password-toggle:hover { color: #d946ef; }
        .match-ok { color: #0ecb81; font-size: 13px; margin-top: 4px; }
        .match-bad { color: #f87171; font-size: 13px; margin-top: 4px; }
        .strength-bar { height: 4px; border-radius: 2px; background: #2b3139; margin-top: 6px; overflow: hidden; }
        .strength-fill { height: 100%; border-radius: 2px; width: 0; transition: width 0.2s, background 0.2s; }
        .signup-email { color: #9ca3af; font-size: 14px; margin-bottom: 20px; }
        .signup-email strong { color: #fff; }
    </style>
</head>
<body>

    <div class="auth-container">
        <div class="auth-marketing">
            <div class="brand-logo">
                <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>
                <span>NexusCrypto</span>
            </div>
            <div class="hero-content">
                <h1>Almost there <br><span class="gradient-text">Set your password</span></h1>
                <div class="visual-box">
                    <div class="floating-coin">â‚¿</div>
                    <div class="glow-effect"></div>
                </div>
                <div class="trust-badges">
                    <div class="badge-item">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#db2777" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                        <div class="badge-text">
                            <strong>Secure</strong>
                            <span>Bank-grade encryption</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="auth-form-wrapper">
            <div class="form-card">
                <div class="form-header">
                    <h2>Create Your Password</h2>
                    <p class="signup-email">Signing up as: <strong>{{ email }}</strong></p>
                </div>

                <form action="{% url 'signup_password' %}" method="post" id="signup-password-form">
                    {% csrf_token %}
                    {% if errors %}
                        <div class="form-error">
                            {% for err in errors %}<div>{{ err }}</div>{% endfor %}
                        </div>
                    {% endif %}
                    <div class="input-group">
                        <label for="id_password1">Password</label>
                        <input type="password" name="password1" id="id_password1" placeholder="Min 8 characters" required autocomplete="new-password">
                        <div class="strength-bar" aria-hidden="true"><div class="strength-fill" id="strength-fill"></div></div>
                        <span class="password-toggle" id="toggle1" aria-label="Show password">Show password</span>
                    </div>
                    <div class="input-group">
                        <label for="id_password2">Confirm password</label>
                        <input type="password" name="password2" id="id_password2" placeholder="Re-enter password" required autocomplete="new-password">
                        <span class="match-ok" id="match-ok" style="display:none;">Passwords match</span>
                        <span class="match-bad" id="match-bad" style="display:none;">Passwords do not match</span>
                        <span class="password-toggle" id="toggle2" aria-label="Show password">Show password</span>
                    </div>
                    <button type="submit" class="btn-submit">Create Account</button>
                </form>

                <div class="footer-link">
                    <a href="{% url 'login' %}">Back to email step</a>
                </div>
            </div>
        </div>
    </div>

    <script>
(function () {
    var form = document.getElementById('signup-password-form');
    var p1 = document.getElementById('id_password1');
    var p2 = document.getElementById('id_password2');
    var matchOk = document.getElementById('match-ok');
    var matchBad = document.getElementById('match-bad');
    var strengthFill = document.getElementById('strength-fill');

    function updateMatch() {
        var v2 = (p2 && p2.value) || '';
        if (v2.length === 0) {
            matchOk.style.display = 'none';
            matchBad.style.display = 'none';
        } else if (p1.value === p2.value) {
            matchOk.style.display = 'block';
            matchBad.style.display = 'none';
        } else {
            matchOk.style.display = 'none';
            matchBad.style.display = 'block';
        }
    }
    if (p1) p1.addEventListener('input', updateMatch);
    if (p2) p2.addEventListener('input', updateMatch);

    function strengthScore(p) {
        if (!p) return 0;
        var s = 0;
        if (p.length >= 8) s += 25;
        if (p.length >= 12) s += 15;
        if (/[a-z]/.test(p) && /[A-Z]/.test(p)) s += 20;
        if (/\d/.test(p)) s += 20;
        if (/[^a-zA-Z0-9]/.test(p)) s += 20;
        return Math.min(100, s);
    }
    function updateStrength() {
        if (!strengthFill) return;
        var score = strengthScore(p1 && p1.value);
        strengthFill.style.width = score + '%';
        strengthFill.style.background = score < 40 ? '#f87171' : score < 70 ? '#eab308' : '#0ecb81';
    }
    if (p1) p1.addEventListener('input', updateStrength);

    function toggleVisibility(inputId, toggleId) {
        var input = document.getElementById(inputId);
        var toggle = document.getElementById(toggleId);
        if (!input || !toggle) return;
        toggle.addEventListener('click', function () {
            var isPass = input.type === 'password';
            input.type = isPass ? 'text' : 'password';
            toggle.textContent = isPass ? 'Hide password' : 'Show password';
        });
    }
    toggleVisibility('id_password1', 'toggle1');
    toggleVisibility('id_password2', 'toggle2');

    if (form) {
        form.addEventListener('submit', function (e) {
            if ((p1 && p2) && p1.value !== p2.value) {
                e.preventDefault();
                matchBad.style.display = 'block';
                matchOk.style.display = 'none';
                return false;
            }
        });
    }
})();
    </script>
</body>
</html>
